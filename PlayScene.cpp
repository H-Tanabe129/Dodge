#include "PlayScene.h"
#include "Player.h"
#include "Stage.h"
#include "Item.h"
#include "BackGround.h"
#include "ValueManager.h"
#include "Engine/Audio.h"
#include "Engine/Camera.h"
#include "Engine/Input.h"

//コンストラクタ
PlayScene::PlayScene(GameObject * parent)
	: GameObject(parent, "PlayScene"), pText(nullptr), hBGM_(-1)
{
}

//初期化
void PlayScene::Initialize()
{
	//サウンドデータのロード
	hBGM_ = Audio::Load("A2_01003.WAV", true);
	assert(hBGM_ >= 0);
	Audio::Play(hBGM_);
	Audio::SetVolume(hBGM_, VSet);

	Camera::SetPosition(XMFLOAT3(CPosiX, CPosiY, CPosiZ));
	Camera::SetTarget(XMFLOAT3(CTarX, CTarY, CTarZ));

	// すべての子オブジェクトを削除
	KillAllChildren();
	
	Instantiate<BackGround>(this);
	Instantiate<Player>(this);
	Instantiate<Stage>(this);
	Instantiate<Item>(this);

	pText = new Text;
	pText->Initialize();

	ValueManager::GetInstance().ResetScore();
	ValueManager::GetInstance().ResetTime();
}

//更新
void PlayScene::Update()
{
	ValueManager::GetInstance().AddScore(score);
	ValueManager::GetInstance().AddTime();
}

//描画
void PlayScene::Draw()
{
	pText->Draw(scoreX, scoreY, "Score:");
	pText->Draw(scoreX+100, scoreY, ValueManager::GetInstance().GetScore());
	pText->Draw(timeX, timeY, "Time: ");
	pText->Draw(timeX+100, timeY, ValueManager::GetInstance().GetTime());
}

//開放
void PlayScene::Release()
{
	pText->Release();
}

// 子オブジェクトを全て削除
void PlayScene::KillAllChildren()
{
	for (auto& child : *GetChildList())  // ポインタをデリファレンスしてリストを取得
	{
		child->KillMe();
	}
	GetChildList()->clear();  // ポインタをデリファレンスしてリストをクリア
}